<p align="center">
<img src=../../README_images/jen_ter_aws_logos.png width="400">
</p>

<h1 align="center">Welcome to the November playground!</h1>

[The Playground link](https://github.com/DevOpsPlayground/Hands-on-with-Jenkins-Terraform-and-AWS)

For this playground, we will be building an automated CI/CD pipeline that deploys a scalable React web application to AWS. Here's an overview of what we'll cover:

* Write a Jenkins DSL script. This allows us to define our pipeline configuration as code (Pipeline as Code).
* Trigger a build of this script which will create a new, empty pipeline that is configured with all the settings we need.
* Write *another* script for the newly created pipeline which will define the various stages our application needs to go through before being deployed to AWS. These include:
    - Building the application.
    - Testing it.
    - Deploying it to an AWS autoscaling group using terraform (Infrastructure as Code).

## Important

Before we get started there are a few things that are worth noting. We have set the defaults to a number of variables that can be changed within the `variables.tf` file if required:

* The default `region` is set to `eu-west-2`
* The default `instance_count` is set to 1
* The default number of `instances` is set to 1. Change if testing a more highly available set up.
* The default `deploy_count` is set to 1. Change this if you are running the playground for more than one user.
* The default `instance_type` is set to t2.medium as the t2.micro does not have enough resource to efficiently run a Jenkins instance. This on-demand pricing is $0.0464 per hour (£0.034 per hour). Should you leave this running for 1 month (720 hours), you would be charged $33.63 (£24.48) per instance. **make sure you delete the instance when finished with the playground!**
## Install Terraform

Before we deploy our Jenkins instance using Terraform you will need to install Terraform on your local machine. Please [visit the Hashicorp website](https://learn.hashicorp.com/tutorials/terraform/install-cli) for how to do this.

## Building Infrastructure

**Please make sure you have run through the installation process for AWS CLI and AWS config in the [root README.md file](../../README.md)**

Once we have Terraform installed make sure you are in the `November` directory and run:

```
$ terraform init
```  
This will initialise a working directory containing our Terraform configuration files. This command is always safe to run multiple times, to bring the working directory up to date with changes in the configuration. You should see the following:

<p align="center">
<img src=../../README_images/tf_init.png width="600">
</p>

Then run:
```
$ terraform plan
```

This command is used to create an execution plan. Terraform performs a refresh, unless explicitly disabled, and then determines what actions are necessary to achieve the desired state specified in the configuration files.

This command is a convenient way to check whether the execution plan for a set of changes matches your expectations without making any changes to real resources or to the state. For example, terraform plan might be run before committing a change to version control, to create confidence that it will behave as expected. The plan will be fairly long but if all went well you should see the following in your terminal:

<p align="center">
<img src=../../README_images/tf_plan.png width="600">
</p>

Finally you need to run:
```
$ terraform apply
```

This command is used to apply the changes required to reach the desired state of the configuration, or the pre-determined set of actions generated by a terraform plan execution plan. You will be prompted to enter a value to perform the action. Type `yes` as the value and hit enter.

Terraform will now build our required AWS infrastructure. This should complete after a minute or so showing the following:

<p align="center">
<img src=../../README_images/tf_apply.png width="600">
</p>

Your EC2 instance will now be initialising and running the required script to install and launch Jenkins. Once ths `instance state` has changed to `Running` you should be able to access your instance in your browser using the jenkins IP detailed in your Terraform outputs.

**Be sure to add `:8080` at the end as the running container is mapping to port 8080 within your instance.**

If you can see the following then we're good to go!

![jenkins_homepage](../../README_images/jenkins_homepage.png)

#### Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| InstanceRole | The Role of the instance to take | `number` | `null` | no |
| PlaygroundName | The playground name to tag all resouces with | `string` | `"nov"` | no |
| deploy_count | Change this for the number of users of the playground | `number` | `1` | no |
| instance_count | The amount of versions of the infrastructer to make | `number` | `1` | no |
| instance_type | instance type to be used for instances | `string` | `"t2.medium"` | no |
| instances | number of instances per user | `number` | `1` | no |
| policyLocation | The location of the policys | `string` | `"./../../policies"` | no |
| region | The aws region to deploy to | `string` | `"eu-west-2"` | no |
| scriptLocation | The location of the userData folder | `string` | `"./../../modules/instance/scripts"` | no |

#### Outputs

| Name | Description |
|------|-------------|
| jenkins_ips | The ip of the jenkins instances |

